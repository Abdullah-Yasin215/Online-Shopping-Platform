@model train.Models.Product
@{
    ViewData["Title"] = Model.Name;
}
@await Html.PartialAsync("_CartToastAndSignalR")

<div class="container mt-4">
    <div class="row g-4">
        <!-- Image Column -->
        <div class="col-md-6">
            <img src="@(Model.ImageUrl ?? "/img/placeholder.png")"
                 alt="@Model.Name"
                 class="img-fluid rounded shadow-sm w-100"
                 style="max-height: 560px; object-fit: cover;" />
        </div>

        <!-- Details Column -->
        <div class="col-md-6">
            <h2 class="mb-1">@Model.Name</h2>
            <div class="text-muted mb-2">
                @Model.Category?.Name
                @if (!string.IsNullOrWhiteSpace(Model.Category?.Color))
                {
                    <span>· @Model.Category!.Color</span>
                }
            </div>

            <div class="display-6 mb-3">AED @Model.Price.ToString("F2")</div>

            @if (!string.IsNullOrWhiteSpace(Model.Description))
            {
                <p class="mb-4">@Model.Description</p>
            }

            @{
                var sizes = !string.IsNullOrEmpty(Model.Sizes) ? Model.Sizes.Split(',').Select(s => s.Trim()).ToArray() : Array.Empty<string>();
                var colors = !string.IsNullOrEmpty(Model.Colors) ? Model.Colors.Split(',').Select(c => c.Trim()).ToArray() : Array.Empty<string>();
            }

            <form asp-controller="Cart" asp-action="Add" method="post"
                  class="add-to-cart-form">
                @Html.AntiForgeryToken()
                <input type="hidden" name="productId" value="@Model.Id" />
                <input type="hidden" name="returnUrl" value="@Context.Request.Path@Context.Request.QueryString" />

                @* Size Selection *@
                @if (sizes.Any())
                {
                    <div class="mb-3">
                        <label class="form-label fw-bold">Size <span class="text-danger">*</span></label>
                        <div class="d-flex flex-wrap gap-2">
                            @foreach (var size in sizes)
                            {
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="selectedSize" 
                                           id="size_@size" value="@size" required>
                                    <label class="form-check-label btn btn-outline-secondary" for="size_@size" 
                                           style="cursor: pointer; padding: 0.375rem 0.75rem;">
                                        @size
                                    </label>
                                </div>
                            }
                        </div>
                    </div>
                }

                @* Color Selection *@
                @if (colors.Any())
                {
                    <div class="mb-3">
                        <label class="form-label fw-bold">Color @(colors.Length > 1 ? "(Optional)" : "")</label>
                        @if (colors.Length == 1)
                        {
                            <div class="text-muted">
                                <span class="badge bg-secondary text-white">@colors[0]</span>
                            </div>
                            <input type="hidden" name="selectedColor" value="@colors[0]" />
                        }
                        else
                        {
                            <select name="selectedColor" class="form-select">
                                <option value="">Any Color</option>
                                @foreach (var color in colors)
                                {
                                    <option value="@color">@color</option>
                                }
                            </select>
                        }
                    </div>
                }

                <div class="d-flex align-items-end gap-2">
                    <div>
                        <label class="form-label">Quantity</label>
                        <input type="number" name="qty" value="1" min="1" max="@Model.Stock" 
                               class="form-control" style="width:120px;" />
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg">Add to Cart</button>
                </div>
            </form>

            <div class="mt-3 text-muted">
                In stock: @Model.Stock
            </div>
        </div>
    </div>
</div>